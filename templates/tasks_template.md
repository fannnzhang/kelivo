# ✅ tasks.md — 执行任务分解模板（架构无关 · 可在不同工程落地）

> 定位：本模板用于规范化大模型生成“可执行、可验收、可回滚”的技术任务清单。不得固化具体技术细节，需完全贴合当前仓库与 design.md/requirements.md。

---

## 0. 元信息（Meta）

- Feature/Bug 名称：`<title>`
- Spec 路径：`spec/<feature-or-bug-name>/tasks.md`
- 版本/日期：`vX.Y · YYYY-MM-DD`
- 所有者/评审人：`<owner>` / `<reviewers>`
- 关联文档：`requirements.md`、`design.md`

状态标记（务必统一）：
- `[ ]` 未开始（Not Started）
- `[-]` 进行中（In Progress）
- `[x]` 已完成（Done）

引用约定：
- 需求引用：`Req: <章节编号>`（如 `Req: 3.1, 3.4`）
- 设计引用：`Design: <章节/模块>`（如 `Design: 3. 渐进式 · Phase 2` 或 `Design: 模块/数据/接口`）

---

## 1. 全局执行规则（必须遵循）

- 与 requirements/design 严格对齐；不得凭空新增不可验证的工作项。
- 任务应“原子化 + 可验证 + 可回滚”，每项都要有明确验收标准与验证命令。
- 标注受影响文件/目录路径（新增/修改/删除），避免模糊描述。
- 如存在特性开关/Mock/环境差异，明确开关名、默认值与切换方式。
- 对于缺少自动化测试的项目，提供手工用例步骤与录屏/截图要求。
- 每个 Phase 在结束前必须满足“退出清单（Exit Checklist）”。

---

## 2. 分阶段规划（概览）

> 概览表用于鸟瞰；详细执行请在每个 Phase 的“任务块”中展开。

| Phase | 标题 | 目标 | 主要产出 | 验收方式 |
|------:|------|------|----------|----------|
| 1 | `<标题>` | `<阶段目标>` | `<UI/数据/本地/Mock>` | `<Demo/日志/命令>` |
| 2 | `<标题>` | `<阶段目标>` | `<流程/交互/校验>` | `<用例/截图>` |
| 3 | `<标题>` | `<阶段目标>` | `<存储/缓存/离线>` | `<断网/恢复验证>` |
| 4 | `<标题>` | `<阶段目标>` | `<接口/轮询/推送>` | `<Stage 验收>` |

---

## 3. Phase 详情块（为每个 Phase 复制一份）

### Phase <编号>: <标题>

- 目标（Goals）：`<本阶段业务/技术目标>`
- 入/出标准（Entry/Exit）：`<准备条件>` / `<完成定义 DoD>`
- 依赖与开关（Deps & Flags）：`<Feature Flag/Mock/外部依赖>`
- 验收与演示（Acceptance & Demo）：`<进入路径/期望 UI/状态/日志/埋点>`

#### 任务列表（Tasks）

- `[ ] <序号> <任务标题>`  
  描述：`<要做什么，为什么>`  
  依赖：`Req: <编号>；Design: <章节/模块>；Task: <前置任务ID>`  
  修改点/路径：`<a/b/c.dart:12>、<lib/...>`  
  接口/数据/状态：`<涉及的接口/数据模型/状态机要点>`  
  验收（Acceptance）：`<可操作路径、UI/状态变化、日志或埋点校验>`  
  验证命令（Commands）：`<构建/分析/测试/生成>`  
  回滚（Rollback）：`<关闭开关/版本回退/数据回滚>`

- `[-] <序号.子序号> <子任务标题>`  
  描述：`<实现要点/边界>`  
  依赖：`Req: <…>`  
  修改点/路径：`<…>`  
  验收：`<…>`

- `[x] <序号.子序号> <子任务标题>`  
  描述/验证小结：`<完成事实与截图/日志位置>`

> 建议编号规则：`1, 1.1, 1.2, 2, 2.1, …` 与 design.md 的 Phase、模块结构保持语义对应。

#### 退出清单（Exit Checklist）

- [ ] 代码通过构建与静态检查（如：`<analyze/lint/build>`）
- [ ] 测试通过（或提供手工用例与录屏/截图）
- [ ] 文档同步（requirements/design/tasks/changelog）
- [ ] Feature Flag 默认正确，可热关闭
- [ ] 性能/内存/功耗无回退（或记录基线对比）
- [ ] 安全/权限/合规项确认
- [ ] 日志/埋点可观测且已校验

---

## 4. 贯穿所有阶段的任务（Cross-Phase Tasks）

- `[ ] QA 与手工用例` — 逐阶段回归与问题跟踪（Req: `<全部/关键章节>`）
- `[ ] 错误处理与 UX 优化` — 统一错误模型、可重试与兜底提示（Design: `错误处理`）
- `[ ] 性能优化` — 关键路径与缓存策略（Design: `性能与资源`）
- `[ ] 安全与日志` — 敏感信息处理与关键操作审计（Design: `安全与隐私`）
- `[ ] 国际化与样式` — 文案与主题一致性（如适用）
- `[ ] 发布与回滚预案` — 渠道、版本与应急手册更新

---

## 5. 示例（可删除）

- `[ ] 1. 本地数据与 UI 骨架`（Req: `1`；Design: `Phase 1`）
  - `[ ] 1.1 扩展本地实体与迁移` — 路径：`<lib/.../entity.dart>`；命令：`<generate/migrate>`
  - `[ ] 1.2 构建状态标签组件` — 路径：`<lib/.../widget/...>`；验收：`<页面可见/状态正确>`

> 示例仅示意写法与颗粒度，生成实际 tasks.md 时必须替换为本仓库真实路径、命令与验收方式。

